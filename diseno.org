#+title: Menos cruces (aka backflips vs portaviones)

* índice

- [[#conceptos-generales][conceptos generales]]
- [[#elementos-de-juego][elementos de juego]]
- [[#screen-flow][screen flow]]

* conceptos generales
** dinámica global

Vampire survivors, top-down 2D. se acumulan "monedas", que son buffs temporales hasta que se asientan en el mercader. Dificultad creciente de enemigos para gestionar gráfica de dificultad. La ronda es una acumulación de dificultad/buff que hay que "resetear" en el mercader.

** Mecánicas

- Moverse 8D
- coger monedas "pequeñas" para multiplicador
- monedas grandes (menos probables) para buff
- mercader wanderea y deja rastro
  - entrar en mercader resetea multiplicador
  - asienta buffs
- al coger moneda grande, menú de roll
  - puede salir positivo o negativo
  - se puede cancelar el "roll" con pérdida de monedas (parámetro)

* elementos de juego

Todas las distancias se definen aquí en función de $L$, que es la anchura del jugador. El jugador mide $L\times L$.

** player

*** stats

los stats son realmente *funciones*, no variables

- ataque: $1+ataque(ronda\_local, ronda\_global,monedas\_grandes)$.
- velocidad de ataque (en ataques por segundo): $0.5+velocidad(ronda\_local, ronda\_global,monedas\_grandes)$
- distancia de ataque: $2 \times L + ataque(ronda\_local, ronda\_global,monedas\_grandes)$.
- velocidad de movimiento (en $\frac{L}{s}$): $L + velocidad(ronda\_local, ronda\_global,monedas\_grandes)$.
- escudo: $velocidad(ronda\_local, ronda\_global,monedas\_grandes)$.
- recuperación de vida: $velocidad(ronda\_local, ronda\_global,monedas\_grandes)$
- vida máxima: =vida máxima inicial= + $velocidad(ronda\_local, ronda\_global,monedas\_grandes)$ )

variables que se modifican:

- monedas: variable que *sí* se actualiza durante el /gameplay/.
- vida actual:  (al llegar a 0, se acaba la partida). Comienza siendo la vida máxima. *cada vez que se coge una moneda, hay que restar la nueva vida máxima menos la actual, y si es mayor que cero, se suma eso a la vida actual*.

*** ataques

**** La goma de la máscara
Genera un área rectangular de daño (WxH). Está activa durante D segundos y luego se desactiva

** monedas y buffs
*** Monedas pequeñas

Simplemente son un contador, hay un porcentaje global de "enemigo deja moneda". Al cogerlas por overlap se suma 1 a "monedas" (de [[#player][player]])


Cada enemigo un token de $random([rglobal, rlocal + rglobal])$ monedas. Tienen un 85% de dejar token. 

*** monedas "grandes"
:PROPERTIES:
:ID:       92c25efe-3ef4-4183-a975-ada5a4443947
:END:

estas son las monedas que pueden ser cara a cruz. Al cogerlas, sale un menú:
#+DOWNLOADED: screenshot @ 2026-01-31 11:10:47
[[file:menú_monedas/2026-01-31_11-10-47_screenshot.png]]

y =roll= puede ser cara o cruz. Salga lo que salga, se aplica un buff. Cuando se visita al mercader, se fija el valor de las "monedas grandes" con el multiplicador actual de las pequeñas, y esas ya no cambian.

Hay unos 2500 enemigos por ronda (ver [[#tabla-enemigos][tabla de enemigos]]). En 30 rondas de juego, 75000 enemigos, en la ronda 10, eso serían $85\% \times 75000 \times 10 \approx 20000$ monedas. Así que cada moneda me da $\frac{1}{20000} = 0.0005$ de buff... Digamos que cada moneda me da un multiplicador de 0.001 (positivo o negativo).

**** buffs

Los buffs van conceptualmente juntos. Todo buff tiene cara positiva o negativa. Se pueden acumular los buffs.

***** Buffs de mecánicas

Los buffs de mecánicas se acumulan: se pueden tener varios y se activan en cuanto se cogen. 

****** Hedor infernal

- Cara: Genera un área circular de radio $2\times L$ que genera el triple del daño de jugador cada 5 segundos.
- Cruz: Genera un área circular de radio $2\times L$ que genera un escudo a los enemigos de la mitad del daño del jugador, cada 7 segundos. 

****** Halitosis
Dispara un objeto en la dirección en la que se mueve cada 2.5 segundos. El objeto viaja 2 veces la velocidad de la pantalla, y va a $4\times$ de la velocidad del jugador.

***** buffs de stats

****** 

***** buffs temporales

****** 

** rondas
El juego tiene un =int= que es el número de ronda actual local, que se resetea en el mercader. También hay un =int= de veces total, que son las rondas reales desde el principio.


Cada ronda es:

- un tiempo de generación (se generan durante $N$ segundos)
- un tiempo de espera (que puede ser 0) entre rondas (desde que acaba una hasta que empieza otra)
- los enemigos que salen

** enemigos


=enemigos= es los enemigos que se esperan hasta maximizar sistema general de ronda (correlaciona con el tiempo de juego con "enemigos por segundo" )

Progresión de enemigos en crecimiento exponencial basado en máximo esperado de enemigos

*** tipos de enemigos

**** enemigo que va hacia ti en línea recta

Parámetros:

- velocidad
- vida
- dps
- distacia de ataque

cuando está a menos de =distacia de ataque= (param) se activa el DPS. Al recibir impacto de héroe pierde vida. cuando vida <= 0, muere.

Cuando está a distancia de ataque o menos, no se mueve.

**** enemigo que dispara

- velocidad
- vida
- dps
- distacia de ataque
- velocidad proyectil
- daño proyectil
- distancia disparo

mismos parámetros que enemigo en línea recta. Pero cuando =distancia-a-personaje < distancia-disparo= lanza ataque (un proyectil que va en línea recta hacia personaje). Al impactar el proyectil, se quita =daño proyectil=.

**** Spawn de enemigos


Hay una una función $f(número\_ronda\_local, número\_ronda\_global)$ que, dada un número de ronda, devuelve el tiempo que falta para la siguiente ronda. Al cumplirse este, se suman los contadores de ronda y se hace un /spawn/.


- función de tiempo hasta próxima ronda: $time\_to\_next\_round(local\_round, global\_round)$, devuelve segundos
- función de composición de ronda (cuántos enemigos de qué tipo): devuelve un JSON con:
          #+begin_src json
        [
        {
        "tipo": "enemigo_tipo_1",
        "cuántos": 24
        },
        {
        "tipo": "enemigo_disparo_1",
        "cuántos": 4
        }
        ]
        #+end_src

Y se espera que la posición de cada enemigo sea aleatoria con una función que, dada una distancia mínima (que esté fuera de pantalla) y una máxima (más fuera aún) encuentre un punto aleatorio en distribución uniforme para hacer el spawn de cada enemigo.


#+DOWNLOADED: screenshot @ 2026-01-31 11:10:47
[[file:area_spawn.svg]]


# | ! | ronda | vida-inicial | enemigos | dano_medio_enemigo | probabilidad_dano_por_enemigo | dano_esperado |
# |---+-------+--------------+----------+--------------------+-------------------------------+---------------|
# | # |     1 |            5 |      100 |                1.0 |                        0.0001 |          0.01 |
# | # |     2 |              |          |                    |                               |             0 |
# #+TBLFM: $7='(* $enemigos $dano_medio_enemigo $probabilidad_dano_por_enemigo);N

*** tabla enemigos

#+name: constantes
| tiempo aproximado por ronda          |   90 |
| vida inicial                         |    5 |
| velocidad inicial (en L por segundo) |    1 |
| velocidad inicial bala               | 0.75 |
| velocidad inicial enemigos           |  0.5 |
| daño inicial enemigos                |    1 |
| enemigos medios por segundo          |   30 |


#+name: consecuencias
| enemigos aprox. por ronda | 2700 |
#+TBLFM: $2=remote(constantes, @7$2) * remote(constantes, @1$2)

#+name: crecimiento-enemigos
#+plot: file:"./crecimiento.svg"
| ! | ronda_global | ronda_local |         movimiento |               dano | tiempo_mercader |
|---+--------------+-------------+--------------------+--------------------+-----------------|
| # |            1 |           1 |                1.0 |             1.0088 |              45 |
| # |            2 |           2 |             1.0088 | 1.0352000000000001 |              90 |
| # |            3 |           3 | 1.0352000000000001 | 1.0792000000000002 |             135 |
| # |            4 |           4 | 1.0792000000000002 |             1.1408 |             180 |
| # |            5 |           1 |             1.0128 |              1.028 |              45 |
| # |            6 |           2 |              1.028 |             1.0608 |              90 |
| # |            7 |           4 |             1.1008 | 1.1671999999999998 |             180 |
| # |            8 |           5 | 1.1671999999999998 | 1.2511999999999999 |             225 |
#+TBLFM: $4='(+ 1 (* 0.0008 (expt (- $ronda_global 1) 2)) (* 0.008 (expt  (- $ronda_local 1) 2)));N::$5='(+ 1 (* 0.0008 (expt $ronda_global 2)) (* 0.008 (expt  $ronda_local 2)));N::$6='(* $ronda_local remote(constantes, @1$2));N

$movimiento = 1 + 0.008 \times rlocal^2 + 0.0008 \times rglobal^2$

[[file:./crecimiento.svg]]

El daño medio por enemigo es directamente proporcional a los enemigos en pantalla y su velocidad, e inversamente proporcional al poder del jugador.

* screen flow

[[file:screenflow.svg]]
