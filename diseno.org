#+title: Menos cruces (aka backflips vs portaviones)

* conceptos generales
** dinámica global

Vampire survivors, top-down 2D. se acumulan "monedas", que son buffs temporales hasta que se asientan en el mercader. Dificultad creciente de enemigos para gestionar gráfica de dificultad. La ronda es una acumulación de dificultad/buff que hay que "resetear" en el mercader.

** Mecánicas

- Moverse 8D
- coger monedas "pequeñas" para multiplicador
- monedas grandes (menos probables) para buff
- mercader wanderea y deja rastro
  - entrar en mercader resetea multiplicador
  - asienta buffs
- al coger moneda grande, menú de roll
  - puede salir positivo o negativo
  - se puede cancelar el "roll" con pérdida de monedas (parámetro)

* elementos de juego

Todas las distancias se definen aquí en función de $L$, que es la anchura del jugador. El jugador mide $L\times L$.

** player
*** stats

los stats son realmente *funciones*, no variables

- ataque: $1+ataque(ronda\_local, ronda\_global,monedas\_grandes)$.
- velocidad de ataque (en ataques por segundo): $0.5+velocidad(ronda\_local, ronda\_global,monedas\_grandes)$
- distancia de ataque: $2 \times L + ataque(ronda\_local, ronda\_global,monedas\_grandes)$.
- velocidad de movimiento (en $\frac{L}{s}$): $L + velocidad(ronda\_local, ronda\_global,monedas\_grandes)$.
- escudo: $velocidad(ronda\_local, ronda\_global,monedas\_grandes)$.
- recuperación de vida: $velocidad(ronda\_local, ronda\_global,monedas\_grandes)$
- vida máxima: =vida máxima inicial= + $velocidad(ronda\_local, ronda\_global,monedas\_grandes)$)

variables que se modifican:

- monedas: variable que *sí* se actualiza durante el /gameplay/.
- vida actual:  (al llegar a 0, se acaba la partida). Comienza siendo la vida máxima. *cada vez que se coge una moneda, hay que restar la nueva vida máxima menos la actual, y si es mayor que cero, se suma eso a la vida actual*.

*** ataques

**** La goma de la máscara
Genera un área rectangular de daño (WxH). Está activa durante D segundos y luego se desactiva

** monedas y buffs
*** Monedas pequeñas

Simplemente son un contador, hay un porcentaje global de "enemigo deja moneda". Al cogerlas por overlap se suma 1 a "monedas" (de player)

*** monedas "grandes"
:PROPERTIES:
:ID:       92c25efe-3ef4-4183-a975-ada5a4443947
:END:

estas son las monedas que pueden ser cara a cruz. Al cogerlas, sale un menú:
#+DOWNLOADED: screenshot @ 2026-01-31 11:10:47
[[file:menú_monedas/2026-01-31_11-10-47_screenshot.png]]

y =roll= puede ser cara o cruz. Salga lo que salga, se aplica un buff.

**** buffs

Los buffs van conceptualmente juntos. Todo buff tiene cara positiva o negativa. Algunos buffs *tienen precondiciones*.

***** Buffs

****** Hedor infernal I
Genera un área circular de radio R que genera daño D

****** Hedor infernal II [precondición: HEDOR INFERNAL I]
Desactiva hedor infernal I

****** Halitosis I
Dispara un objeto en la dirección en la que se mueve cada S segundos


***** buffs de stats

***** buffs temporales

** rondas
El juego tiene un =int= que es el número de ronda actual local, que se resetea en el mercader. También hay un =int= de veces total, que son las rondas reales desde el principio.

** enemigos


=enemigos= es los enemigos que se esperan hasta maximizar sistema general de ronda (correlaciona con el tiempo de juego con "enemigos por segundo" )

Progresión de enemigos en crecimiento exponencial basado en máximo esperado de enemigos

*** tipos de enemigos

**** enemigo que va hacia ti en línea recta

Parámetros:

- velocidad
- vida
- dps
- distacia de ataque

cuando está a menos de =distacia de ataque= (param) se activa el DPS. Al recibir impacto de héroe pierde vida. cuando vida <= 0, muere.

Cuando está a distancia de ataque o menos, no se mueve.

**** enemigo que dispara

- velocidad
- vida
- dps
- distacia de ataque
- velocidad proyectil
- daño proyectil
- distancia disparo

mismos parámetros que enemigo en línea recta. Pero cuando =distancia-a-personaje < distancia-disparo= lanza ataque (un proyectil que va en línea recta hacia personaje). Al impactar el proyectil, se quita =daño proyectil=.

**** Spawn de enemigos


Hay una una función $f(número\_ronda\_local, número\_ronda\_global)$ que, dada un número de ronda, devuelve el tiempo que falta para la siguiente ronda. Al cumplirse este, se suman los contadores de ronda y se hace un /spawn/.


- función de tiempo hasta próxima ronda: $time\_to\_next\_round(local\_round, global\_round)$, devuelve segundos
- función de composición de ronda (cuántos enemigos de qué tipo): devuelve un JSON con:
          #+begin_src json
        [
        {
        "tipo": "enemigo_tipo_1",
        "cuántos": 24
        },
        {
        "tipo": "enemigo_disparo_1",
        "cuántos": 4
        }
        ]
        #+end_src

Y se espera que la posición de cada enemigo sea aleatoria con una función que, dada una distancia mínima (que esté fuera de pantalla) y una máxima (más fuera aún) encuentre un punto aleatorio en distribución uniforme para hacer el spawn de cada enemigo.


#+DOWNLOADED: screenshot @ 2026-01-31 11:10:47
[[file:area_spawn.svg]]


# | ! | ronda | vida-inicial | enemigos | dano_medio_enemigo | probabilidad_dano_por_enemigo | dano_esperado |
# |---+-------+--------------+----------+--------------------+-------------------------------+---------------|
# | # |     1 |            5 |      100 |                1.0 |                        0.0001 |          0.01 |
# | # |     2 |              |          |                    |                               |             0 |
# #+TBLFM: $7='(* $enemigos $dano_medio_enemigo $probabilidad_dano_por_enemigo);N

* screen flow

[[file:screenflow.svg]]

* Pendiente

** TODO hacer "enemigos por segundo"

** TODO hacer buffs temporales
